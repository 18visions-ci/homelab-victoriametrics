---
- name: Ensure the directory for VictoriaMetrics data exists on NAS
  file:
    path: "{{ victoria_metrics_dir }}"
    state: directory
    owner: victoriametrics
    group: victoriametrics
    mode: '0755'

- name: Set the correct ownership for the VictoriaMetrics directory
  file:
    path: "{{ victoria_metrics_dir }}"
    owner: victoriametrics
    group: victoriametrics
    recurse: yes

- name: Copy the systemd service file for VictoriaMetrics
  copy:
    src: victoriametrics.service  # This is now in the 'files' directory
    dest: /etc/systemd/system/victoriametrics.service
    mode: '0644'  # You can set permissions now, as the file is copied from 'files'

- name: Reload systemd to register the new service
  systemd:
    daemon_reload: yes

- name: Enable and start VictoriaMetrics service
  systemd:
    name: victoriametrics
    state: started
    enabled: yes
